echo
echo "More intense snapshots/clones"
INTENSITY=10
TEST_FILE=/tmp/a_block_of_as
COMP_FILES=/tmp/snap
rm -f $TEST_FILE
# a block of 1s (for dd'ing in)
for i in `seq 4096`; do echo -n "a">> ${TEST_FILE}; done
# create file (for comparison) 
dd if=/dev/zero of=${COMP_FILES}0 bs=4K count=${INTENSITY} 2>/dev/null
do_control_create ${INTENSITY}
do_control_attach ${VOL_VER}
CURR_SNAP=${VOL_VER}
FIRST_CLONE=""
for I in `seq 1 $(( ${INTENSITY} - 1 ))`; do
	H=$(( $I - 1 ))
	
	echo "Snapshotting and cloneing snapshot ${CURR_SNAP}, dev ${DEV} ($I of ${INTENSITY})"
	
	do_control_snapshot ${DEV}
	do_control_clone    ${CURR_SNAP}
    if [ "x"$FIRST_CLONE == "x" ]; then
        FIRST_CLONE=${CLONE_VER}
    fi
    CURR_SNAP=${SNAP_VER}
	
	dd conv=notrunc if=${TEST_FILE} of=${DEV} bs=4K count=1 seek=$I 2>/dev/null
	cp ${COMP_FILES}${H} ${COMP_FILES}${I}
	dd conv=notrunc if=${TEST_FILE} of=${COMP_FILES}${I} bs=4K count=1 seek=$I 2>/dev/null
done

echo "Comparing saved files and snapshots"
for I in `seq 1 $(( ${INTENSITY} - 1 ))`; do
	H=$(( $I - 1 ))
    CURR_SNAP=$(($FIRST_CLONE + 2*$H))
    echo "Comparing ${COMP_FILES}${H} with snapshot ${CURR_SNAP}"
    do_control_attach `printf "%X" ${CURR_SNAP}`
    echo "Got device: ${DEV}"
    check_contents_file ${DEV} ${COMP_FILES}${H} ${INTENSITY}
    do_control_detach ${DEV}
done


